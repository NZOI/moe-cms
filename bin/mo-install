#!/bin/bash

[ -f config ] || { echo "Missing config file, check cwd." ; exit 1 ; }
set -e
. config
make

H=`pwd`

# mo-eval home
cd $MO_ROOT
rm -rf eval
mkdir eval
chgrp $EVAL_GROUP eval
chmod 550 eval
cd eval
echo "Creating $EVAL_USER"
mkdir $EVAL_USER
cd $EVAL_USER
cp -a $H/* .
chmod +x bin/*
cd ..
chown -R $EVAL_USER.$EVAL_GROUP $EVAL_USER
chmod 700 $EVAL_USER

( cd $EVAL_USER ; bin/mo-create-testusers )

# common
cd $MO_ROOT
echo "Creating public"
rm -rf public
mkdir public
cd public
cp -a $H/bin $H/config .
mkdir problems
cp -a $H/public/* bin/
chmod +x bin/*
cd ..
chown -R $EVAL_USER.$EVAL_GROUP public
chmod 755 public
