#!/bin/bash

[ -f config ] || { echo "Missing config file, check cwd." ; exit 1 ; }
set -e
. config
make

H=`pwd`
cd $MO_ROOT

# mo-eval home
echo "Creating $EVAL_USER"
rm -rf ./$EVAL_USER
mkdir $EVAL_USER
cd $EVAL_USER
cp -a $H/* .
mv bin/profile .profile
chmod +x bin/*
cd ..
chown -R $EVAL_USER.$EVAL_GROUP $EVAL_USER
chmod 700 $EVAL_USER

( cd $EVAL_USER ; bin/mo-create-testusers )

# common
echo "Creating public"
rm -rf public
mkdir public
cd public
cp -a $H/bin $H/config .
mkdir problems
cp -a $H/public/* bin/
chmod +x bin/*
cd ..
chown -R $EVAL_USER.$EVAL_GROUP public
chmod 755 public

# SSH keys (FIXME)
#echo "Copying SSH keys"
#mkdir $EVAL_USER/.ssh
#cp ~mj/.ssh/authorized_keys $EVAL_USER/.ssh/
#chown -R $EVAL_USER $EVAL_USER/.ssh
